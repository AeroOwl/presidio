# Presidio build and release

Presidio continuous processes govern its integrity and stability through the dev, test and and release phases.
The project currently supports [Azure Pipelines](https://azure.microsoft.com/en-us/services/devops/pipelines/) using YAML pipelines which can be easily imported to any Azure Pipelines instance.


## Presidio Azure Devops Pipelines

The following pipelines are provided:

***[Base images CI Pipeline](../pipelines/CI-deps.yaml)*** - build and test persidio base images for golang and python.  

- Images are always pushed with build-id (in PR and CI)
- Feature branch images are pushed with branch-name tag.

***[Presidio services CI Pipeline](../pipelines/CI-presidio.yaml)*** - build and test persidio services. 

- Depending on branch, images will be pushed with build-id and:
    -   **master branch** - pushed with "latest" tag
    -   **development branch** - pushed with "latest-dev" tag
    -   **feature branch** - pushed with branch-name tag.
- Artifacts generated by a PR CI are not pushed to container registry
- Presidio CI triggered by build-dependency to deps-CI will use deps images label with the build-id of the triggering CI
- Feature branches are not supported for build-dependency. after CI-deps completes, a manual trigger of CI-Presidio is required.

### Note that the following settings have to be set in Azure Pipelines, for each imported pipeline:

#### Variables
* ***registry*** - a docker registry service endpoint to your private docker registry
* ***registry_name*** - the name of the registry

#### Triggers
* ***Build Completion*** - CI-Presidio should be triggered by a completion of CI-Deps.
Add a "Build Completion" CI trigger in Azure Pipelines UI (for both master and development branches), depending on CI-Deps, as setting this in YAML is not yet supported in Azure Piplelines ([Feature Request](https://developercommunity.visualstudio.com/content/problem/293487/build-completion-trigger-not-working-for-yaml-buil.html))


### import a pipeline to Azure Devops

* Sign in to your Azure DevOps organization and navigate to your project.

* In your project, navigate to the Pipelines page. Then choose the action to create a new pipeline.

* Walk through the steps of the wizard by first selecting 'Use the classic editor, and select GitHub as the location of your source code.

* You might be redirected to GitHub to sign in. If so, enter your GitHub credentials.

* When the list of repositories appears, select presidio repository.

* Point Azure Pipelines to the relevant yaml definition you'd like to import. Set the pipeline's name, the required triggers and variables and Select Save and run.

* A new run is started. Wait for the run to finish.